<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<!--
   +MMMMMM.     MMMMM7    MMMMMMMMMMM.    MMMMMM7     MMMMM  MMMMM. .MMMMMMMMMMMMMMM    MMMMMMMMMMMMMMM
    MMMMMMM.  .MMMMMM   MMMMMMMMMMMMMM8   MMMMMM7     MMMMM  MMMMM   MMMMMMMMMMMMMMMMM  MMMMMMMMMMMMMMM
     MMMMMMM  MMMMM?   MMMMMMMM7MMMMMMMM. MMMMMM7     MMMMM  MMMMM.  MMMMMM7778MMMMMMM= MMMMMMMMMMMMMMM
      MMMMMMMMMMMMM.  :MMMMMM7   .MMMMMM. MMMMMM7     MMMMM   .MM,   MMMMMM.   .MMMMMMM MMMMMM
       MMMMMMMMMMM    MMMMMMM     MMMMMMM MMMMMM7     MMMMM   MM,    MMMMMM.  ..MMMMMMO MMMMMM
        MMMMMMMMM     MMMMMMO     MMMMMMM MMMMMM7     MMMMM          MMMMMMMMMMMMMMMMM  MMMMMMMMMMMMM
         MMMMMMM.     MMMMMM$     NMMMMMM MMMMMM7     MMMMM          MMMMMMMMMMMMMMMD   MMMMMMMMMMMMM
         =MMMMMI     .MMMMMMM.    MMMMMMM MMMMMM7     MMMMM          MMMMMMMMMMMMMMI    MMMMMM
         =MMMMM7      DMMMMMM     MMMMMM$ MMMMMM8    .MMMMM          MMMMMM. ZMMMMMM    MMMMMM
         =MMMMM7      .MMMMMMM . MMMMMMM  MMMMMMMM .ZMMMMM7          MMMMMM...MMMMMMM   MMMMMMMMMMMMMMM
         =MMMMM7        MMMMMMMMMMMMMMM.  .MMMMMMMMMMMMMMM           MMMMMM.  .MMMMMMI  MMMMMMMMMMMMMMM
         =MMMMM7         8MMMMMMMMMMMZ.     MMMMMMMMMMMMM            MMMMMM.  .MMMMMMM  MMMMMMMMMMMMMMM
         =MMMMM7            $MMMMM?            NMMMMMM.              MMMMMM     MMMMMMM MMMMMMMMMMMMMMM


       .=MMMMMMM.     OMMMMMM    .MMMMM       MMMMMMM       MMMMMM    ~MMMMMM
      MMMMMMMMMMMMM.  8MMMMMM     MMMMM    8MMMMMMMMMMM$    MMMMMM    =MMMMMM
     MMMMMMMMMMMMMMM. 8MMMMMM     MMMMM   MMMMMMMMMMMMMMM   MMMMMM    =MMMMMM
   .MMMMMM,  .?MMMMD. 8MMMMMM     MMMMM .MMMMMMM. .MMMMMM.  MMMMMM    =MMMMMM
   .MMMMMMM.          8MMMMMM     MMMMM  MMMMMM.   .MMMMMM. MMMMMM    =MMMMMM
    NMMMMMMMMMMMM~..  8MMMMMM     MMMMM :MMMMMM.            MMMMMMMMMMMMMMMMM
    .MMMMMMMMMMMMMMM  8MMMMMM     MMMMM 8MMMMMM             MMMMMMMMMMMMMMMMM
       MMMMMMMMMMMMMD 8MMMMMM     MMMMM 8MMMMMM             MMMMMMMMMMMMMMMMM
           ,MMMMMMMMM 8MMMMMM     MMMMM  MMMMMM.    MMMMMZ  MMMMMM    =MMMMMM
   MMMMMM.     MMMMMM 8MMMMMM     MMMMM .MMMMMM,    MMMMMM. MMMMMM    =MMMMMM
    MMMMMMMMMMMMMMMMM  MMMMMMMMMMMMMMM8   MMMMMMMMMMMMMMM   MMMMMM    =MMMMMM
    .MMMMMMMMMMMMMMM   $MMMMMMMMMMMMMM     MMMMMMMMMMMMM.   MMMMMM    =MMMMMM
      OMMMMMMMMMMM.      MMMMMMMMMMM.       8MMMMMMMMMZ     MMMMMM    ~MMMMMM


         MMMMMMM.
        ?MMMMMMM:
        MMMMMMMMM
       :MMMMMMMMM.
       MMMMMMMMMMM.
      ,MMMM  MMMMM.
      MMMMM  MMMMMM
     ,MMMMI77DMMMMM.
     MMMMMMMMMMMMMMM
    .MMMMMMMMMMMMMMM.
    MMMMM     .MMMMMM
   .MMMMM      MMMMMM.
   MMMMM.      OMMMMMM


   7MMMMMM      MMMMM  MMMMMMMMMMMMMMM  MMMMMMMMMMMMMMM    MMMMMMMMMMMM8.
   7MMMMMMM     MMMMM  MMMMMMMMMMMMMMM  MMMMMMMMMMMMMMMMO. MMMMMMMMMMMMMMM
   7MMMMMMMM.   MMMMM  MMMMMMMMMMMMMMM  MMMMMM777MMMMMMMM. MMMMMMMMMMMMMMMM
   7MMMMMMMMM.  MMMMM  MMMMMM           MMMMMM    .MMMMMM= MMMMMM    MMMMMMM.
   7MMMMMMMMMM  MMMMM  MMMMMM           MMMMMM.  ..MMMMMM  MMMMMM     MMMMMM.
   7MMMM MMMMMM.MMMMM  MMMMMMMMMMMMM    MMMMMMMMMMMMMMMMM. MMMMMM     MMMMMMI
   7MMMMI MMMMMNMMMMM  MMMMMMMMMMMMM    MMMMMMMMMMMMMMM~   MMMMMM     MMMMMMZ
   7MMMM7  MMMMMMMMMM  MMMMMM           MMMMMMMMMMMMMM     MMMMMM     MMMMMM
   7MMMM7  =MMMMMMMMM  MMMMMM           MMMMMM  MMMMMMM.   MMMMMM   .MMMMMMM
   7MMMM7   +MMMMMMMM  MMMMMM           MMMMMM   MMMMMMO   MMMMMM...MMMMMMM.
   7MMMM7    ?MMMMMMM  MMMMMMMMMMMMMMM  MMMMMM  .DMMMMMM.  MMMMMMMMMMMMMMM.
   7MMMM7    .IMMMMMM  MMMMMMMMMMMMMMM  MMMMMM    MMMMMMM  MMMMMMMMMMMMMN
   7MMMM7      $MMMMM  MMMMMMMMMMMMMMM..MMMMMM    .MMMMMM$ MMMMMMMMMI

-->
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>  ssh&#8217;ing to different machines with the same ip - greg&#039;s weblog</title>
<meta name="robots" content="all">
<meta name="author" content="Greg Knapp">
<meta name="description" content="Greg's web log about software development, operating systems and other geeky topics">
<meta name="viewport" content="width=1024px">
<link rel="me" type="text/html" href="http://www.google.com/profiles/virtual.greg">
<link rel="stylesheet" type="text/css" media="screen" href="http://static.gregk.me/css/style.min.130721.css">
<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" media="screen" href="http://static.gregk.me/css/ie6.css">
<![endif]-->
<!--[if IE]>
<style type="text/css" media="screen">
.post div.content, .post div.comments {
	display: inline-block;
}

#query {
    line-height: 1.6;
}
</style>
<![endif]-->

<script type='text/javascript' src='http://archive.gregk.me/wp-includes/js/comment-reply.min.js?ver=3.8.3'></script>

<link rel='prev' title='Changing user home directory under Mac OS X' href='index.html?p=151' />
<link rel='next' title='A real UK keyboard layout for Snow Leopard' href='index.html?p=221' />

<link rel='canonical' href='index.html?p=195' />
<link rel='shortlink' href='index.html?p=195' />
</head>
<body>
<div id="container_header">
  <div id="header">
    <div class="title"><a href="index.html">greg&#039;s weblog</a></div>
    <div class="slug">the more I learn, the less I know</div>
  </div>
</div>
<div id="container_flooring">
  <div id="flooring">
    <div id="books">
      <img src="resources/images/books.png" width="330" height="298" usemap="#map_books" alt="about me" title="">
      <map name="map_books" id="map_books">
        <area shape="poly" coords="17,73,81,288,210,248,254,264,321,88,206,37,173,8,140,36" href="about" alt="about me" title="">
      </map>
    </div>
    <div id="camera">
      <img src="resources/images/camera.png" width="165" height="178" usemap="#map_camera" alt="photography">
      <map name="map_camera" id="map_camera">
        <area shape="poly" coords="10,24,34,100,29,133,39,165,157,125,143,77,126,66,111,75,106,92,98,93,93,87,97,75,75,2" href="photography.html" alt="photography" title="">
      </map>
    </div>
    <div id="macbook">
      <img src="resources/images/macbook.png" width="373" height="357" usemap="#map_macbook" alt="software projects">
      <map name="map_macbook" id="map_macbook">
        <area shape="poly" coords="49,5,55,98,9,279,273,346,318,167,374,86" href="software.html" alt="software projects" title="">
      </map>
    </div>
    <div id="iphone">
      <img src="resources/images/iphone.png" width="81" height="107" usemap="#map_iphone" alt="contact me">
      <map name="map_iphone" id="map_iphone">
        <area shape="poly" coords="7,83,37,2,79,17,50,99" href="contact.html" alt="contact me">
      </map>
    </div>
  </div>
</div>
<div id="container_stage">
    <div id="stage">
        <div id="content" class="hfeed">
              <div class="post hentry" id="post-195">
                <div class="heading">
                    <div class="date">
                        <div class="day">14</div><div class="month">Feb</div>
                    </div>
                    <div class="title">
                        <h1 class="entry-title"><a href="index.html?p=195">SSH&#8217;ing to different machines with the same IP</a></h1>
                        <small>
                        	posted <abbr class="published" title="2010-02-14T16:27:30+00:00">2010</abbr> // 
                        	<a href="category/tech/index.html" title="View all posts in tech" rel="category tag">tech</a> // <span class="comment"><a href="index.html?p=195#comments">1</a></span>
                        </small>
                    </div>
                </div>
                <div class="content entry-content">
                	<p>Like a lot of people, I ditched my desktop in 2007 and moved to a laptop as my main computer. I take my Macbook Pro to work everyday and it&#8217;s also my personal computer at home.</p>
<p>To make life simpler I have an almost identical network set up at home as we do in the office, using the same DHCP range and gateway address (our dev server is also our gateway in the office). So the development server I SSH into at work has the same IP as my home linux box. At work we have internal DNS set up, I&#8217;m a little more lazy at home and just refer to my linux box by IP.<br />
<span id="more-195"></span><br />
A problem arises doing this though; since I connected to the office development server with SSH first, it got first place in my known_hosts file, consequently when I connect to my home linux server (with the same internal IP address) I&#8217;m presented with a warning &#8216;REMOTE HOST IDENTIFICATION HAS CHANGED!&#8217; and I that I could be subject to a &#8216;man in the middle attack&#8217;.</p>
<div class="center">
<img src="http://i993.photobucket.com/albums/af54/g4egk/ssh.png" alt="SSH warning - remote host identification changed" /><br />Oh noes!</div>
<p>Of course this isn&#8217;t really the case, my linux server just has a different RSA key fingerprint to the office dev machine. There&#8217;s two ways we can surpress this&#8230;</p>
<p><b>First Method &#8211; disable strict key checking &amp; tell ssh to shut up</b><br />
When you SSH to a machine for the first time, you&#8217;re prompted to save the machine&#8217;s fingerprint to your <code>known_hosts</code> file. Your SSH client will save the hostname (if you used one) and the IP address it resolved to:</p>
<pre class="bash">&lt;hostname&gt;,&lt;ip&gt; ssh-rsa &lt;public key&gt;</pre>
<p><em>I only recommend this for machines on your LAN / inside your DMZ, and not across the public internet.</em></p>
<p>SSH always resolves hostnames to an IP and complains if two keys for the same IP address exist in your <code>known_hosts</code>. To surpress this you can use the following arguments:</p>
<pre class="bash">$ ssh -o "StrictHostKeyChecking=no" -q hostname</pre>
<p>That&#8217;s quite a handful to type, you can <a href="2010/02/25/setting-up-aliases-in-snow-leopard/index.html">alias this command</a> in bash to save your fingers some work.</p>
<pre class="bash">$ alias sshq="ssh -o 'StrictHostKeyChecking=no' -q"
$ sshq hostname</pre>
<p><b>Method Two &#8211; temporarily ignore your known_hosts</b><br />
Using the <code>-o</code> switch we can redefine the location of our known hosts file to <code>/dev/null</code> by overriding UserKnownHostsFile. Observe:</p>
<pre class="bash">$ ssh -o "UserKnownHostsFile /dev/null" <a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="6015130512205159524e5156584e504e51">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>
The authenticity of host '192.168.0.1' can't be established.
RSA key fingerprint is 35:f8:d4:46:0e:...:9f.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.0.1' (RSA) to the list of known hosts.
Linux hostname 2.6.18-6-k7 #1 SMP Mon Oct 13 16:52:47 UTC 2008 i686</pre>
<p>While SSH has said it&#8217;s saved your server IP to known hosts, it really hasn&#8217;t as it&#8217;s writing to <code>/dev/null</code>.</p>
<p>Hopefully these two methods prove more convenient than swapping <code>known_hosts</code> files.</p>
                    <div class="g-plusone" data-size="medium"></div>
                        <a href="https://twitter.com/share?via=g4egk&amp;text=SSH&#8217;ing to different machines with the same IP" class="twitter-share-button">Tweet</a>
                    <br>
                </div>
                <div id="previous"></div>
                <div id="next"></div>
                
                
  <div class="comments">
    <h3>comments</h3><a name="comments"></a>
      <div class="comment hcomment" id="comment-4600">
      <small class="poster vcard">
                  <span class="fn">Georges Dupéron</span> //
                <abbr class="dtposted" title="2013-02-12T21:20:15+00:00">12.Feb.2013</abbr> // 21:20      </small>
      <div class="description">
        <p>To keep the securtity, but have this work, you can leverage `~/.ssh/config`, by telling it to use two different `known_hosts` files depending upon where you&#8217;re connecting.</p>
<p>To connect, you will use `ssh home` to connect to the home server and `ssh work` to connect to the work server.</p>
<p>First, in `~/.ssh/known_hosts_home`, put the `, ssh-rsa ` for your home server, and in `~/.ssh/known_hosts_work`, put the `, ssh-rsa ` for your work server (or you can leave both files empty, and ssh will write this information the first time, but you should ensure your&#8217;re not victim of a man-in-the-middle attack at that moment).</p>
<p>Then, in `~/.ssh/config`, add the following lines:</p>
<p>Host home<br />
    # This is optional:<br />
    User yourusername<br />
    # This is optional, especially if the hostname is resolved by the DNS or by /etc/hosts:<br />
    Hostname 192.168.0.1<br />
    # This is optional, useful only if you use  public/private key authentification (you can generate the keys using ssh-keygen):<br />
    IdentityFile ~/.ssh/id_rsa_home<br />
    UserKnownHostsFile ~/.ssh/known_hosts_home</p>
<p>Host work<br />
    # This is optional:<br />
    User yourusername<br />
    # This is optional, especially if the hostname is resolved by the DNS or by /etc/hosts:<br />
    Hostname 192.168.0.1<br />
    # This is optional, useful only if you use  public/private key authentification (you can generate the keys using ssh-keygen):<br />
    IdentityFile ~/.ssh/id_rsa_work<br />
    UserKnownHostsFile ~/.ssh/known_hosts_work</p>
      </div>
    </div>
    	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
</div>



              </div>
        </div>
    <div id="peripheral">
      <div id="blog_meta">
        <div id="search">
                    <form method="get" action="http://archive.gregk.me/search" accept-charset="utf-8">
                        <fieldset><input type="text" id="query" name="s" value="" /></fieldset>
                    </form>        </div>
        
        <div class="tags">
          <h4>this post's tags</h4>
                  </div>
      </div>
      <div id="feeds">

      </div>
    </div>
    </div>
</div>
<script charset="utf-8" src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
<script type="text/javascript">
  window.___gcfg = {lang: 'en-GB'};

  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<div id="container_footer">
    <div id="footer" class="vcard">
        <div class="who">
        	<h4>Who am I?</h4>
        	<p>My name is Greg &amp; this is my blog.
        	I'm a software engineer, amateur photographer, dad &amp; fulltime nerd.</p>
        	<p class="adr">I live in
        	<a href="http://maps.google.co.uk/maps/place?q=Hitchin" class="locality">Hitchin</a>, <abbr title="United Kingdom" class="country-name">England</abbr>. Once in a blue moon I write my thoughts on this blog.</p>
        </div>
        <div class="when">&nbsp;</div>
        <div class="where">
            <a href="http://github.com/gknapp" title="view my code" id="github"><span>My github projects</span></a>
            <a href="http://www.linkedin.com/in/g4egk" title="view my professional profile" id="linkedin" rel="me"><span>My Linkedin profile</span></a>
        </div>
        <div class="notice">
        	<strong>&copy; 2005-2014 <span class="fn n"><span class="given-name">Greg</span> <span class="family-name">Knapp</span></span>.</strong>
        	Views expressed here are my own and not necessarily those of my employer.
        </div>
        <div class="clear"><!-- for iPhone --></div>    </div>
</div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1966441-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript">
  !window.jQuery && document.write(
  	unescape('%3Cscript src="http://static.gregk.me/js/jquery-1.4.2.min.js"%3E%3C/script%3E')
  )
</script>
<!--[if lt IE 7]>
<script type="text/javascript" src="http://static.gregk.me/js/jquery.ifixpng2.js"></script>
<script type="text/javascript">
  $.ifixpng('http://static.gregk.me/images/pixel.gif');
  $("#books img, #camera img, #macbook img, #iphone img").ifixpng();
</script>
<![endif]-->
<script type="text/javascript" src="http://static.gregk.me/js/min.110426.js"></script>
</body>
</html>
